
## 1 项目背景

本工具旨在解决经济数据统计工作中，为达成特定增长目标（如社零额增速7.5%）而反复手动调整、计算和验证的痛点。当前流程需要耗费3-4小时进行“试错”，效率低下。此工具将通过实时计算和智能调整，将这一过程缩短至几分钟，实现高效、直观的数据模拟与调优。

## 2 核心概念与关键字段

### 2.1 核心概念

*   **社零额 (社会消费品零售总额)**：衡量消费市场规模的宏观经济指标，即所有企业售卖给个人和家庭的商品总金额。
*   **限上企业 (限额以上企业)**：规模较大的重点企业，是本工具表格中直接操作的数据主体。
*   **限下企业 (限额以下企业)**：规模较小的小微企业，其数据通过“限上小微企业”的增速进行抽样估算。
*   **小微企业**：在本业务中，指数据表格里“单位规模”字段为3或4的企业。
*   **当月数据**：指当前操作月份的数据。
*   **累计数据**：指从年初（1月）到当前操作月份的累计数据。

### 2.2 关键数据字段 (Excel导入)

| 字段名称            | 英文/拼音参考                    | 描述与用途                             |
| :-------------- | :------------------------- | :-------------------------------- |
| **企业名称**        | `CompanyName`              | 用于区分是哪家公司。                        |
| **行业代码**        | `IndustryCode`             | 区分 **批发、零售、住宿、餐饮** 四大行业。          |
| **单位规模**        | `CompanyScale`             | 区分是否为“小微企业”（值为3或4）。               |
| **上年同期零售额**     | `RetailLastYearMonth`      | 去年同月的零售额，计算**当月增速**的基数。           |
| **本期零售额**       | `RetailCurrentMonth`       | 今年当月的零售额，是**主要调整对象**。             |
| **上年累计零售额**     | `RetailLastYearCumulative` | 去年1月至当月的累计零售额，计算**累计增速**的基数。      |
| **本年累计零售额**     | `RetailCurrentCumulative`  | 今年1月至当月的累计零售额，会随**本期零售额**变化而实时更新。 |
| **上年同期销售额/营业额** | `SalesLastYearMonth`       | 去年同月的总销售额/营业额。                    |
| **本期销售额/营业额**   | `SalesCurrentMonth`        | 今年当月的总销售额/营业额。                    |
| **上年累计销售额/营业额** | `SalesLastYearCumulative`  | 去年1月至当月的累计销售额/营业额。                |
| **本年累计销售额/营业额** | `SalesCurrentCumulative`   | 今年1月至当月的累计销售额/营业额。                |

## 3 导入数据说明


新入库的部分企业是没有历史的数据的, 比如本月新添加的数据, 是没有的;
历史数据有一个范围的要求,  不同的企业的上限和下限不同;
比如零售<mark style="background: #FFB86CA6;">行业</mark>,  是 大于 500w 之间(是一个累计数 , 需要随机+ 波动每一个月的数据)

导入的表格,当期的数据 , 导入的数据历史的数据都是存在的; 一个表里面存在四个子sheet


## 4 核心指标计算逻辑 (共16项)

所有指标的计算都必须是实时联动的。任何一个底层数据（如某公司的`本期零售额`）发生变化，所有相关的16个指标都应立刻刷新。

### 4.1 指标组一：限上社零额 (4个指标)

*   **1. 限上社零额 (当月值)**
    *   **计算公式**：`SUM(所有企业的“本期零售额”)`
*   **2. 限上社零额增速 (当月)**
    *   **计算公式**：`(SUM(本期零售额) - SUM(上年同期零售额)) / SUM(上年同期零售额)`
*   **3. 限上社零额 (累计值)**
    *   **计算公式**：`SUM(所有企业的“本年累计零售额”)`
*   **4. 限上社零额增速 (累计)**
    *   **计算公式**：`(SUM(本年累计零售额) - SUM(上年累计零售额)) / SUM(上年累计零售额)`

### 4.2 指标组二：专项增速 (2个指标)

*   **5. 吃穿用增速 (当月)**
    *   **逻辑**：根据特定行业代码筛选出属于“吃穿用”的企业。
    *   **计算公式**：`(SUM(吃穿用类企业本期零售额) - SUM(吃穿用类企业上年同期零售额)) / SUM(吃穿用类企业上年同期零售额)`
*   **6. 小微企业增速 (当月)**
    *   **逻辑**：筛选出“单位规模”为3或4的企业。
    *   **计算公式**：`(SUM(小微企业本期零售额) - SUM(小微企业上年同期零售额)) / SUM(小微企业上年同期零售额)`
    *   **重要用途**：此增速用于估算“限下社零额”的增速。

### 4.3 指标组三：四大行业增速 (8个指标)

对 **批发、零售、住宿、餐饮** 四个行业，分别计算其当月和累计的销售额/营业额增速。以 **零售业** 为例：

*   **7. 零售业销售额增速 (当月)**
    *   **计算公式**：`(SUM(零售企业本期销售额) - SUM(零售企业上年同期销售额)) / SUM(零售企业上年同期销售额)`
*   **8. 零售业销售额增速 (累计)**
    *   **计算公式**：`(SUM(零售企业本年累计销售额) - SUM(零售企业上年累计销售额)) / SUM(零售企业上年累计销售额)`
*   **9-14. 其他行业增速**：批发、住宿、餐饮行业同理计算，共6个指标。

### 4.4 指标组四：社零总额 (2个指标)

社零总额是 “限上” 与 “限下” 的总和，其增速主要关注累计值。

*   **前提**：需要一个手动输入的已知数：**`上年累计限下社零额`** (由统计部门提供)。

*   **15. 社零总额 (累计值)**
    *   **第一步：估算本年累计限下社零额**
        *   `估算本年累计限下社零额 = 上年累计限下社零额 × (1 + 小微企业增速)`
        *   **注意**：这里的小微企业增速使用 **指标6** 的当月增速来估算，这是业务逻辑的简化。
    *   **第二步：计算社零总额**
        *   `社零总额(累计) = 限上社零额(累计值) + 估算本年累计限下社零额`
        *   其中，`限上社零额(累计值)` 来自 **指标3**。

*   **16. 社零总额增速 (累计)**
    *   **第一步：计算上年社零总额 (累计)**
        *   `上年社零总额(累计) = SUM(所有企业的“上年累计零售额”) + 上年累计限下社零额`
    *   **第二步：计算累计增速**
        *   `累计增速 = (本年社零总额(累计) - 上年社零总额(累计)) / 上年社零总额(累计)`

---

## 5 核心功能：双向实时联动

**核心原则：可以联动的全部联动。**

### 5.1 数据驱动指标 (修改公司数据 -> 指标变化)

*   **场景示例**：
    1.  **初始状态**：界面显示所有16个指标的初始值，例如 `限上社零额增速(累计): 7.1%`。
    2.  **用户操作**：用户在表格中找到B公司（小微、零售企业），将其“本期零售额”从 `52` 万修改为 `60` 万。
    3.  **系统实时响应 (毫秒级)**：
        *   B公司的“本年累计零售额”自动增加8万。
        *   **指标1-4** (`限上社零额`) 的当月值、累计值和对应增速全部重新计算并刷新。
        *   **指标6** (`小微企业增速`) 因B公司是小微企业而重新计算。
        *   **指标7-8** (`零售业增速`) 因B公司是零售企业而重新计算。
        *   **指标15-16** (`社零总额`) 因其依赖于 `限上社零额(累计值)` 和 `小微企业增速`，也随之重新估算和计算。
        *   其他相关指标（如 `吃穿用`，如果B公司属于该类）同样更新。
    4.  **最终结果**：用户在界面上会立刻看到所有受影响的指标数字发生变化，例如 `限上社零额增速(累计)` 可能从 `7.1%` 变为 `7.3%`，从而获得即时反馈。

### 5.2 指标驱动数据 (设定目标增速 -> 智能调整数据)

帮助用户自动完成“凑数”的过程。

*   **功能流程**：
    1.  用户在指定输入框内（例如，`限上社零额增速(累计)` 目标）输入 `7.5%`。
    2.  用户点击“智能调整”按钮。
    3.  程序启动后端优化算法，自动修改表格中各家公司的“本期零售额”。

*   **智能调整算法约束条件**：
    1.  **首要目标**：调整后的 `限上社零额增速(累计)` 必须等于 `7.5%`。
    2.  **业务规则1 (硬性)**：任何企业的“本期零售额”不能超过其“本期销售额/营业额”。
    3.  **业务规则2 (软性)**：每家企业的自身增速应控制在一个合理的范围内（例如0%~50%，此范围可配置），避免出现极端值。
    4.  **业务规则3 (优先级)**：优先调整“吃穿用”或指定的重点行业的企业数据。
    5.  **优化目标**：在满足以上所有条件的前提下，对原始数据的总调整幅度应尽可能小，以保证数据的相对真实性。

---

## 6 数据导入与处理


### 6.1 Excel文件结构

*   程序需支持导入包含多个Sheet的Excel文件。一个文件应包含至少四个子表，分别存储不同类型或时期的原始数据。
*   导入的表格不仅包含当期数据，也应包含完整的历史数据字段（如上年同期、上年累计等）。

### 6.2 新入库企业历史数据生成

*   **触发条件**：当导入的数据中，某家企业（新入库）的“上年同期”和“上年累计”等历史数据字段为空时。
*   **生成逻辑**：
    1.  **识别行业与阈值**：根据该企业的“行业代码”，确定其历史数据应遵循的规模阈值（例如：零售业累计销售额 > 500万）。
    2.  **生成随机累计值**：在该阈值之上生成一个随机的“上年累计销售额”目标值（例如，在500万~600万之间随机取一个数，如530万）。
    3.  **模拟月度波动**：将这个累计值按月份（例如12个月）进行拆分，并引入波动，不能简单地做除法。
        *   **建议算法**：可以基于一个基础值（如 `530万 / 12`），叠加一个模拟季节性波动的正弦/余弦函数，再加上小幅的随机噪声，来生成每个月的历史数据。
        *   **示例**：`月度数据 = (总额/12) * (1 + 0.2 * sin(月份 * π / 6)) + (Random(-5%, 5%))`
    4.  **数据回填**：将生成的模拟历史数据填充到该企业对应的“上年同期”、“上年累计”等空缺字段中，使其数据结构与其他企业保持一致，以确保后续所有计算的准确性。

## 7 UI 设计预览


### 7.1 数据导入页面

![[attachments/b4772a2d38cb6e08376c3b18b1ec5864_MD5.png]]

### 7.2 主页面

![[attachments/1c615097a3c8f69b8e74bb461a9cb240_MD5.png]]

全部指标和两大增速;

