# Northstar V3 - 简化架构设计

## 变更概述

| 维度 | V2 (当前) | V3 (目标) |
|------|----------|----------|
| 项目管理 | 多项目制 | 单项目（无项目概念） |
| 数据存储 | 内存 + JSON 持久化 | SQLite 文件数据库 |
| 导入流程 | 4步向导 + 字段映射 | 一键导入 + 自动解析 |
| 首页 | ProjectHub 项目列表 | Dashboard 仪表板 |
| 复杂度 | 高（多项目、多 Sheet 映射） | 低（单数据源、自动识别） |

## 核心设计原则

1. **数据库优先**：预设计好表结构，Excel 只是数据来源
2. **自动解析**：智能识别 Excel 字段，无需用户手动映射
3. **单一入口**：启动即仪表板，右上角导入数据
4. **稳定可控**：数据库结构固定，业务逻辑清晰

## 目录结构

```
specs/003/
├── README.md           # 本文件 - 总览
├── 01_database.md      # 数据库表结构设计
├── 02_excel_parser.md  # Excel 自动解析策略
├── 03_frontend.md      # 前端页面设计
├── 04_backend.md       # 后端 API 设计
└── 05_migration.md     # 从 V2 迁移指南
```

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                         前端 (React)                             │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  Topbar     │  │ ImportModal │  │      Dashboard          │  │
│  │  - 导入按钮 │  │ - 进度显示  │  │  - 指标卡片 (16项)      │  │
│  │  - 导出按钮 │  │ - 日志输出  │  │  - 企业数据表格         │  │
│  │  - 设置     │  │             │  │  - 筛选/排序/编辑       │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         后端 (Go)                                │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  Handlers   │  │  Services   │  │      Calculator         │  │
│  │  - Import   │  │  - Parser   │  │  - Engine (DAG)         │  │
│  │  - Company  │  │  - Store    │  │  - 16项指标计算         │  │
│  │  - Export   │  │  - Config   │  │  - 增量更新             │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     SQLite (data/northstar.db)                   │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  companies  │  │   config    │  │     import_logs         │  │
│  │  (企业数据) │  │  (系统配置) │  │    (导入历史)           │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```

## 用户流程

### 首次使用
```
启动应用 → 仪表板(空数据提示) → 点击"导入数据" → 选择Excel文件
    → 自动解析进度 → 完成 → 仪表板显示数据
```

### 日常使用
```
启动应用 → 仪表板(显示已有数据) → 查看/编辑企业数据 → 指标实时联动
    → 导出定稿Excel
```

### 数据更新
```
仪表板 → 点击"导入数据" → 选择新Excel → 自动比对更新 → 完成
```

## 技术选型

| 组件 | 选型 | 理由 |
|------|------|------|
| 数据库 | SQLite | 文件数据库、无需安装、Go 原生支持 |
| ORM | go-sqlite3 + 原生 SQL | 轻量、性能好 |
| 前端 | React + shadcn/ui | 现有基础、无需迁移 |
| Excel | excelize | 现有基础、功能完备 |

## 关键变更清单

### 后端
- [x] 移除 `internal/model/project.go`
- [x] 新增 `internal/store/sqlite.go` - SQLite 存储层
- [x] 重构 `internal/service/excel/parser.go` - 自动解析逻辑
- [x] 简化 `internal/server/handlers/import.go` - 一键导入
- [x] 移除项目相关 API

### 前端
- [x] 移除 `pages/ProjectHub.tsx`
- [x] 移除 `pages/ImportWizard.tsx` (4步向导)
- [x] 新增 `components/ImportModal.tsx` - 简单导入对话框
- [x] 修改 `pages/Dashboard.tsx` - 作为首页
- [x] 移除 `store/projectStore.ts`

### 数据
- [x] 新增 `data/` 目录
- [x] 数据库文件 `data/northstar.db`
- [x] 移除 `data/projects/` 目录结构
