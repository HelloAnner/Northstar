# Northstar 项目设计文档

> 版本: 1.0.0
> 更新日期: 2025-01-25

## 项目概述

Northstar 是一个经济数据统计分析工具，用于解决社零额增长目标计算中的反复调整问题。该工具部署为独立的二进制文件，启动后自动打开浏览器访问本地 Web 页面。

## 核心功能

1. **Excel 数据导入** - 支持多工作表、字段映射、历史数据自动生成
2. **16 项指标实时计算** - 限上社零、专项增速、四大行业、社零总额
3. **双向数据联动** - 修改企业数据实时更新指标，修改目标增速智能调整企业数据
4. **智能优化算法** - 在约束条件���自动调整数据达成目标增速

## 设计文档目录

| 文档 | 描述 |
|------|------|
| [architecture.md](./architecture.md) | 系统架构设计 - 技术栈、目录结构、构建流程 |
| [calculation-logic.md](./calculation-logic.md) | 指标计算联动逻辑 - 16个指标的计算公式和依赖关系 |
| [api.md](./api.md) | API 接口设计 - RESTful API 定义和数据模型 |
| [frontend-components.md](./frontend-components.md) | 前端组件设计 - React 组件结构和样式规范 |
| [test-cases.md](./test-cases.md) | 测试用例设计 - 计算验证、联动测试、边界条件 |
| [workflow.md](./workflow.md) | **实现工作流** - 4阶段任务分解、依赖关系、里程碑 |

## 技术栈

| 层级 | 技术选型 |
|------|----------|
| 后端 | Go 1.21+ |
| 前端 | React 18 + TypeScript + Vite |
| 样式 | Tailwind CSS + shadcn/ui |
| 状态管理 | Zustand |
| Excel处理 | excelize (Go) |
| 打包 | go:embed |

## 部署形态

| 平台 | 产物 |
|------|------|
| Windows | `northstar.exe` |
| macOS | `northstar` binary |
| Linux | `northstar` binary |

启动后自动打开浏览器，访问 `http://localhost:8080`

## 页面结构

```
/import  - 数据导入向导 (4步骤)
/        - 主控制面板 (指标卡片 + 企业数据表格)
```

## 核心指标 (16项)

### 限上社零额 (4项)
- 限上社零额(当月值)
- 限上社零额增速(当月)
- 限上社零额(累计值)
- 限上社零额增速(累计)

### 专项增速 (2项)
- 吃穿用增速(当月)
- 小微企业增速(当月)

### 四大行业增速 (8项)
- 批发业 - 当月/累计
- 零售业 - 当月/累计
- 住宿业 - 当月/累计
- 餐饮业 - 当月/累计

### 社零总额 (2项)
- 社零总额(累计值)
- 社零总额增速(累计)

## 联动规则

### 数据驱动指标
修改企业的 `本期零售额` → 自动更新 `本年累计零售额` → 重算所有相关指标

### 指标驱动数据
设定 `目标累计增速` → 智能调整算法 → 自动修改符合条件的企业数据

## 开发指南

```bash
# 开发模式
cd web && npm run dev    # 前端开发服务器
go run ./cmd/northstar -dev  # 后端 (代理前端)

# 生产构建
make build-all
```

## 关键约束

1. 零售额不能超过销售额
2. 数值不能为负数
3. 单企业增速范围 0%-50% (可配置)
4. 优先调整吃穿用/餐饮等重点行业
