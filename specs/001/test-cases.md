# 测试用例设计文档

## 1 测试数据集

### 1.1 企业基础数据 (10 家企业)

| ID | 企业名称 | 行业代码 | 行业类型 | 规模 | 是否吃穿用 |
|----|----------|----------|----------|------|------------|
| C001 | 大型商超 A | 5211 | retail | 2 | ✓ |
| C002 | 汽车销售公司 B | 5261 | retail | 1 | ✗ |
| C003 | 电商平台 C | 5291 | retail | 2 | ✓ |
| C004 | 连锁酒店 D | 6110 | accommodation | 2 | ✗ |
| C005 | 餐饮集团 E | 6211 | catering | 3 | ✗ |
| C006 | 批发商 F | 5121 | wholesale | 2 | ✗ |
| C007 | 服装店 G | 5243 | retail | 4 | ✓ |
| C008 | 食品批发 H | 5122 | wholesale | 3 | ✓ |
| C009 | 民宿连锁 I | 6120 | accommodation | 4 | ✗ |
| C010 | 快餐店 J | 6212 | catering | 4 | ✗ |

### 1.2 企业数值数据 (单位: 万元)

| ID | 上年同期零售额 | 本期零售额 | 上年累计零售额 | 本年累计零售额 | 上年同期销售额 | 本期销售额 | 上年累计销售额 | 本年累计销售额 |
|----|----------------|------------|----------------|----------------|----------------|------------|----------------|----------------|
| C001 | 1100 | 1285 | 6800 | 7585 | 1150 | 1250 | 6900 | 7500 |
| C002 | 3550 | 3400 | 18500 | 17950 | 3600 | 3400 | 18800 | 18000 |
| C003 | 990 | 1050 | 5800 | 5860 | 1050 | 980 | 6100 | 6030 |
| C004 | 2000 | 2150 | 11000 | 11830 | 2100 | 2150 | 11500 | 12180 |
| C005 | 480 | 575 | 2800 | 2895 | 500 | 600 | 2900 | 3000 |
| C006 | 5200 | 5350 | 28000 | 28780 | 5500 | 5350 | 29000 | 29500 |
| C007 | 150 | 168 | 850 | 868 | 160 | 170 | 900 | 910 |
| C008 | 1800 | 1950 | 9500 | 9650 | 1900 | 2000 | 10000 | 10100 |
| C009 | 80 | 92 | 420 | 432 | 85 | 95 | 440 | 450 |
| C010 | 120 | 145 | 680 | 705 | 125 | 150 | 700 | 725 |

### 1.3 配置参数

```json
{
  "currentMonth": 6,
  "lastYearLimitBelowCumulative": 50000
}
```

---

## 2 指标计算测试用例

### 2.1 指标组一: 限上社零额 (4个指标)

#### TC-IND-001: 限上社零额当月值计算

**输入:**
- 所有企业的 `retailCurrentMonth` 数据

**计算过程:**
```
限上社零额(当月值) = 1285 + 3400 + 1050 + 2150 + 575 + 5350 + 168 + 1950 + 92 + 145
                   = 16165 (万元)
```

**预期结果:** `16165`

---

#### TC-IND-002: 限上社零额当月增速计算

**输入:**
- SUM(retailCurrentMonth) = 16165
- SUM(retailLastYearMonth) = 1100 + 3550 + 990 + 2000 + 480 + 5200 + 150 + 1800 + 80 + 120 = 15470

**计算过程:**
```
增速 = (16165 - 15470) / 15470
     = 695 / 15470
     = 0.04493 (4.49%)
```

**预期结果:** `4.49%`

---

#### TC-IND-003: 限上社零额累计值计算

**输入:**
- 所有企业的 `retailCurrentCumulative` 数据

**计算过程:**
```
限上社零额(累计值) = 7585 + 17950 + 5860 + 11830 + 2895 + 28780 + 868 + 9650 + 432 + 705
                   = 86555 (万元)
```

**预期结果:** `86555`

---

#### TC-IND-004: 限上社零额累计增速计算

**输入:**
- SUM(retailCurrentCumulative) = 86555
- SUM(retailLastYearCumulative) = 6800 + 18500 + 5800 + 11000 + 2800 + 28000 + 850 + 9500 + 420 + 680 = 84350

**计算过程:**
```
增速 = (86555 - 84350) / 84350
     = 2205 / 84350
     = 0.02615 (2.61%)
```

**预期结果:** `2.61%`

---

### 2.2 指标组二: 专项增速 (2个指标)

#### TC-IND-005: 吃穿用增速(当月)计算

**筛选条件:** `isEatWearUse = true`
**符合企业:** C001, C003, C007, C008

**输入:**
- SUM(retailCurrentMonth) = 1285 + 1050 + 168 + 1950 = 4453
- SUM(retailLastYearMonth) = 1100 + 990 + 150 + 1800 = 4040

**计算过程:**
```
增速 = (4453 - 4040) / 4040
     = 413 / 4040
     = 0.10223 (10.22%)
```

**预期结果:** `10.22%`

---

#### TC-IND-006: 小微企业增速(当月)计算

**筛选条件:** `companyScale IN (3, 4)`
**符合企业:** C005, C007, C008, C009, C010

**输入:**
- SUM(retailCurrentMonth) = 575 + 168 + 1950 + 92 + 145 = 2930
- SUM(retailLastYearMonth) = 480 + 150 + 1800 + 80 + 120 = 2630

**计算过程:**
```
增速 = (2930 - 2630) / 2630
     = 300 / 2630
     = 0.11407 (11.41%)
```

**预期结果:** `11.41%`

---

### 2.3 指标组三: 四大行业增速 (8个指标)

#### TC-IND-007: 零售业销售额增速(当月)

**筛选条件:** `industryType = 'retail'`
**符合企业:** C001, C002, C003, C007

**输入:**
- SUM(salesCurrentMonth) = 1250 + 3400 + 980 + 170 = 5800
- SUM(salesLastYearMonth) = 1150 + 3600 + 1050 + 160 = 5960

**计算过程:**
```
增速 = (5800 - 5960) / 5960
     = -160 / 5960
     = -0.02685 (-2.68%)
```

**预期结果:** `-2.68%`

---

#### TC-IND-008: 零售业销售额增速(累计)

**输入:**
- SUM(salesCurrentCumulative) = 7500 + 18000 + 6030 + 910 = 32440
- SUM(salesLastYearCumulative) = 6900 + 18800 + 6100 + 900 = 32700

**计算过程:**
```
增速 = (32440 - 32700) / 32700
     = -260 / 32700
     = -0.00795 (-0.80%)
```

**预期结果:** `-0.80%`

---

#### TC-IND-009: 批发业销售额增速(当月)

**筛选条件:** `industryType = 'wholesale'`
**符合企业:** C006, C008

**输入:**
- SUM(salesCurrentMonth) = 5350 + 2000 = 7350
- SUM(salesLastYearMonth) = 5500 + 1900 = 7400

**计算过程:**
```
增速 = (7350 - 7400) / 7400
     = -50 / 7400
     = -0.00676 (-0.68%)
```

**预期结果:** `-0.68%`

---

#### TC-IND-010: 住宿业营业额增速(当月)

**筛选条件:** `industryType = 'accommodation'`
**符合企业:** C004, C009

**输入:**
- SUM(salesCurrentMonth) = 2150 + 95 = 2245
- SUM(salesLastYearMonth) = 2100 + 85 = 2185

**计算过程:**
```
增速 = (2245 - 2185) / 2185
     = 60 / 2185
     = 0.02746 (2.75%)
```

**预期结果:** `2.75%`

---

#### TC-IND-011: 餐饮业营业额增速(当月)

**筛选条件:** `industryType = 'catering'`
**符合企业:** C005, C010

**输入:**
- SUM(salesCurrentMonth) = 600 + 150 = 750
- SUM(salesLastYearMonth) = 500 + 125 = 625

**计算过程:**
```
增速 = (750 - 625) / 625
     = 125 / 625
     = 0.20000 (20.00%)
```

**预期结果:** `20.00%`

---

### 2.4 指标组四: 社零总额 (2个指标)

#### TC-IND-012: 社零总额(累计值)计算

**输入:**
- 限上社零额(累计值) = 86555 (来自 TC-IND-003)
- 小微企业增速(当月) = 11.41% (来自 TC-IND-006)
- 上年累计限下社零额 = 50000

**计算过程:**
```
估算本年累计限下社零额 = 50000 × (1 + 0.1141)
                       = 50000 × 1.1141
                       = 55705

社零总额(累计) = 86555 + 55705
               = 142260 (万元)
```

**预期结果:** `142260`

---

#### TC-IND-013: 社零总额增速(累计)计算

**输入:**
- 本年社零总额(累计) = 142260 (来自 TC-IND-012)
- SUM(retailLastYearCumulative) = 84350
- 上年累计限下社零额 = 50000

**计算过程:**
```
上年社零总额(累计) = 84350 + 50000 = 134350

累计增速 = (142260 - 134350) / 134350
        = 7910 / 134350
        = 0.05888 (5.89%)
```

**预期结果:** `5.89%`

---

## 3 联动计算测试用例

### TC-LINK-001: 单企业零售额变更 -> 所有相关指标更新

**场景:** 修改 C001 (零售+小微+吃穿用) 的本期零售额

**操作:**
- 将 C001 的 `retailCurrentMonth` 从 1285 修改为 1500

**预期联动:**
1. C001 的 `retailCurrentCumulative` 自动更新: 7585 + (1500-1285) = 7800
2. 指标1 (限上社零当月值): 16165 + 215 = 16380
3. 指标2 (限上社零当月增速): (16380 - 15470) / 15470 = 5.88%
4. 指标3 (限上社零累计值): 86555 + 215 = 86770
5. 指标4 (限上社零累计增速): (86770 - 84350) / 84350 = 2.87%
6. 指标5 (吃穿用增速): (4453+215-4040) / 4040 = 15.54%
7. **指标6不变** (C001 规模=2，非小微)
8. 指标9 (零售销售额当月增速): 不变 (销售额未变)
9. 指标15 (社零总额累计): 86770 + 55705 = 142475
10. 指标16 (社零总额累计增速): (142475 - 134350) / 134350 = 6.05%

---

### TC-LINK-002: 小微企业变更 -> 影响限下估算

**场景:** 修改 C007 (小微+吃穿用+零售) 的本期零售额

**操作:**
- 将 C007 的 `retailCurrentMonth` 从 168 修改为 200

**预期联动:**
1. C007 的 `retailCurrentCumulative`: 868 + 32 = 900
2. 指标6 (小微增速): 原 2930 -> 2962, 增速 = (2962 - 2630) / 2630 = 12.62%
3. 指标15 (社零总额累计):
   - 新估算限下 = 50000 × 1.1262 = 56310
   - 新累计值 = (86555 + 32) + 56310 = 142897
4. 指标16 更新

---

### TC-LINK-003: 批量更新 -> 一次性重算

**场景:** 同时修改 C001, C002, C005 的零售额

**操作:**
```json
[
  { "id": "C001", "retailCurrentMonth": 1400 },
  { "id": "C002", "retailCurrentMonth": 3600 },
  { "id": "C005", "retailCurrentMonth": 650 }
]
```

**预期:**
- 所有指标一次性重算，非多次重算
- 计算结果正确

---

## 4 校验规则测试用例

### TC-VAL-001: 零售额超过销售额

**场景:** C003 的销售额为 980，尝试设置零售额为 1050

**输入:**
```json
{ "id": "C003", "retailCurrentMonth": 1050 }
```

**预期结果:**
- 返回校验错误: "零售额不能超过总销售额"
- 数据不更新
- 或前端显示红色警告框

---

### TC-VAL-002: 负数校验

**场景:** 尝试设置负数零售额

**输入:**
```json
{ "id": "C001", "retailCurrentMonth": -100 }
```

**预期结果:**
- 返回校验错误: "数值不能为负数"
- 数据不更新

---

### TC-VAL-003: 增速超出合理范围警告

**场景:** 设置后单企业增速超过 100%

**操作:**
- 将 C007 的 `retailCurrentMonth` 从 168 修改为 400 (增速 166%)

**预期结果:**
- 数据允许更新
- 返回警告: "C007 企业增速(166%)超出合理范围(0%-50%)"

---

## 5 智能调整测试用例

### TC-OPT-001: 达成目标增速

**场景:** 当前累计增速 2.61%，目标累计增速 5%

**输入:**
```json
{
  "targetIndicator": "limitAboveCumulativeRate",
  "targetValue": 0.05,
  "constraints": {
    "maxIndividualRate": 0.5,
    "minIndividualRate": 0
  }
}
```

**预期:**
- 调整后 `limitAboveCumulativeRate` ≈ 5%
- 所有企业的单个增速在 0%-50% 之间
- 零售额不超过销售额

---

### TC-OPT-002: 无解情况

**场景:** 目标增速过高，在约束条件下无法实现

**输入:**
```json
{
  "targetIndicator": "limitAboveCumulativeRate",
  "targetValue": 0.50,
  "constraints": {
    "maxIndividualRate": 0.1,
    "minIndividualRate": 0
  }
}
```

**预期:**
- 返回错误: "在当前约束条件下无法达成目标增速"
- 提供最大可达成值

---

### TC-OPT-003: 优先调整指定行业

**场景:** 优先调整餐饮行业

**输入:**
```json
{
  "targetIndicator": "limitAboveCumulativeRate",
  "targetValue": 0.04,
  "constraints": {
    "priorityIndustries": ["catering"]
  }
}
```

**预期:**
- 餐饮企业 (C005, C010) 的调整幅度相对较大
- 其他行业调整幅度较小

---

## 6 边界条件测试用例

### TC-EDGE-001: 零值基数

**场景:** 某企业上年同期零售额为 0

**数据修改:**
- 添加 C011: `retailLastYearMonth = 0`, `retailCurrentMonth = 100`

**预期:**
- 该企业增速显示为 "N/A" 或 "∞"
- 汇总计算时正确处理

---

### TC-EDGE-002: 全部企业数据为零

**场景:** 导入空数据集

**预期:**
- 所有指标显示为 0 或 N/A
- 不抛出除零错误

---

### TC-EDGE-003: 大数据量性能

**场景:** 导入 10000 家企业数据

**预期:**
- 指标计算时间 < 100ms
- 单企业更新响应时间 < 50ms

---

## 7 测试数据汇总表

### 7.1 预期指标计算结果

| 指标ID | 指标名称 | 预期值 |
|--------|----------|--------|
| 1 | 限上社零额(当月值) | 16165 万元 |
| 2 | 限上社零额增速(当月) | 4.49% |
| 3 | 限上社零额(累计值) | 86555 万元 |
| 4 | 限上社零额增速(累计) | 2.61% |
| 5 | 吃穿用增速(当月) | 10.22% |
| 6 | 小微企业增速(当月) | 11.41% |
| 7 | 批发业销售额增速(当月) | -0.68% |
| 8 | 批发业销售额增速(累计) | 待计算 |
| 9 | 零售业销售额增速(当月) | -2.68% |
| 10 | 零售业销售额增速(累计) | -0.80% |
| 11 | 住宿业营业额增速(当月) | 2.75% |
| 12 | 住宿业营业额增速(累计) | 待计算 |
| 13 | 餐饮业营业额增速(当月) | 20.00% |
| 14 | 餐饮业营业额增速(累计) | 待计算 |
| 15 | 社零总额(累计值) | 142260 万元 |
| 16 | 社零总额增速(累计) | 5.89% |
